(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0cd711d7"],{"0d44":function(t,e,a){var i,r,n,s=a("7037").default;(function(a,s){r=[],i=s(),n="function"===typeof i?i.apply(e,r):i,void 0===n||(t.exports=n)})(0,(function(){var t,e={},a=!1,i={watermark_id:"wm_div_id",watermark_prefix:"mask_div_id",watermark_txt:"测试水印",watermark_x:20,watermark_y:20,watermark_rows:0,watermark_cols:0,watermark_x_space:50,watermark_y_space:50,watermark_font:"微软雅黑",watermark_color:"rgba(0, 0, 0, 0.15)",watermark_fontsize:"18px",watermark_alpha:.15,watermark_width:100,watermark_height:100,watermark_angle:15,watermark_parent_width:0,watermark_parent_height:0,watermark_parent_node:null,monitor:!0,document:null,window:null},r=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,n=function(e){a?a=!1:(t&&1===e.length||1===e.length&&e[0].removedNodes.length>=1)&&d(t)},o=void 0!==r,l=o?new r(n):null,c={childList:!0,attributes:!0,subtree:!0},d=function(e){var a=t.document||a;if(1===arguments.length&&"object"===s(arguments[0])){var r=arguments[0]||{};for(key in r)r[key]&&i[key]&&r[key]===i[key]||(r[key]||0===r[key])&&(i[key]=r[key])}var n=a.getElementById(i.watermark_id);n&&n.parentNode&&n.parentNode.removeChild(n);var d=a.getElementById(i.watermark_parent_node),m=d||a.body,p=Math.max(m.scrollWidth,m.clientWidth),u=Math.max(m.scrollHeight,m.clientHeight),h=arguments[0]||{},f=m,g=0,v=0;h.watermark_parent_width||h.watermark_parent_height?f&&(g=f.offsetTop||0,v=f.offsetLeft||0,i.watermark_x=i.watermark_x+v,i.watermark_y=i.watermark_y+g):f&&(g=f.offsetTop||0,v=f.offsetLeft||0);var w=a.getElementById(i.watermark_id),_=null;if(w)w.shadowRoot&&(_=w.shadowRoot);else{w=a.createElement("div"),w.id=i.watermark_id,w.setAttribute("style","pointer-events: none !important; display: block !important;"),_=w;var b=m.children,k=Math.floor(Math.random()*(b.length-1));b[k]?m.insertBefore(w,b[k]):m.appendChild(w)}i.watermark_cols=i.watermark_cols||parseInt((p-i.watermark_x)/(i.watermark_width+i.watermark_x_space));var y,x=parseInt((p-i.watermark_x-i.watermark_width*i.watermark_cols)/i.watermark_cols);i.watermark_x_space=i.watermark_x_space||x?i.watermark_x_space:x,i.watermark_rows=parseInt((u-i.watermark_y)/(i.watermark_height+i.watermark_y_space));var C,D,I,N=parseInt((u-i.watermark_y-i.watermark_height*i.watermark_rows)/i.watermark_rows);i.watermark_y_space=N?i.watermark_y_space:N,d?(y=i.watermark_x+i.watermark_width*i.watermark_cols+i.watermark_x_space*(i.watermark_cols-1),C=i.watermark_y+i.watermark_height*i.watermark_rows+i.watermark_y_space*(i.watermark_rows-1)):(y=v+i.watermark_x+i.watermark_width*i.watermark_cols+i.watermark_x_space*(i.watermark_cols-1),C=g+i.watermark_y+i.watermark_height*i.watermark_rows+i.watermark_y_space*(i.watermark_rows-1));for(var O=0;O<i.watermark_rows;O++){I=d?g+i.watermark_y+(i.watermark_y_space+i.watermark_height)*O:i.watermark_y+(u-C)/2+(i.watermark_y_space+i.watermark_height)*O;for(var S=0;S<i.watermark_cols;S++){D=d?v+i.watermark_x+(p-y)/2+(i.watermark_width+i.watermark_x_space)*S:i.watermark_x+(p-y)/2+(i.watermark_width+i.watermark_x_space)*S;var L=a.createElement("div"),z=a.createTextNode(i.watermark_txt);L.appendChild(z),L.id=i.watermark_prefix+O+S,L.style.webkitTransform="rotate(-"+i.watermark_angle+"deg)",L.style.MozTransform="rotate(-"+i.watermark_angle+"deg)",L.style.msTransform="rotate(-"+i.watermark_angle+"deg)",L.style.OTransform="rotate(-"+i.watermark_angle+"deg)",L.style.transform="rotate(-"+i.watermark_angle+"deg)",L.style.visibility="",L.style.position="absolute",L.className="wk-watermark-dom",L.style.left=D+"px",L.style.top=I+"px",L.style.overflow="hidden",L.style.zIndex="9999999",L.style.fontSize=i.watermark_fontsize,L.style.fontFamily=i.watermark_font,L.style.color=i.watermark_color,L.style.textAlign="center",L.style.width=i.watermark_width+"px",L.style.height=i.watermark_height+"px",L.style.display="block",L.style["-ms-user-select"]="none",_.appendChild(L)}}var $=void 0===e.monitor?i.monitor:e.monitor;$&&o&&(l.observe(m,c),l.observe(_,c))},m=function(){var e=t.document||e;if(1===arguments.length&&"object"===s(arguments[0])){var a=arguments[0]||{};for(key in a)a[key]&&i[key]&&a[key]===i[key]||(a[key]||0===a[key])&&(i[key]=a[key])}var r=e.getElementById(i.watermark_id),n=r.parentNode;n.removeChild(r),l.disconnect()};e.init=function(e){t=e;var a=t.window||a;d(e),a.addEventListener("onload",(function(){d(e)})),a.addEventListener("resize",(function(){d(e)}))},e.load=function(e){t=e,d(e)},e.remove=function(){a=!0,m()};var p=function(e){if(t&&1===e.length||1===e.length&&e[0].removedNodes.length>=1)d(t);else{var a=t.document||a,r=a.getElementById(i.watermark_parent_node);if(r){var n=getComputedStyle(r).getPropertyValue("width"),s=getComputedStyle(r).getPropertyValue("height");n===u.width&&s===u.height||(u.width=n,u.height=s,d(t))}}},u=(l=new r(p),c={childList:!0,attributes:!0,subtree:!0,attributeFilter:["style"],attributeOldValue:!0},{width:0,height:0});return e}))},2309:function(t,e,a){"use strict";a("d302")},"307c":function(t,e,a){t.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},"3ada":function(t,e,a){"use strict";a("9ef2")},"40bf":function(t,e,a){"use strict";a("5d73")},"5d73":function(t,e,a){},8256:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tinymce",class:{"is-print":t.isPrint}},[t.active?a("editor",t._g(t._b({ref:"mceEditor",attrs:{id:t.id,init:t.showInit,plugins:t.showPlugins,toolbar:t.showToolbar,"tinymce-script-src":"https://www.72crm.com/npm/tinymce/tinymce.min.js"},on:{onInit:t.onInit},model:{value:t.dataValue,callback:function(e){t.dataValue=e},expression:"dataValue"}},"editor",t.$attrs,!1),t.$listeners)):t._e(),t._v(" "),t.printSizeDialogVisible?a("print-size-dialog",{attrs:{"default-data":t.printSizeData,visible:t.printSizeDialogVisible},on:{"update:visible":function(e){t.printSizeDialogVisible=e},confirm:t.sizeConfirm}}):t._e()],1)},r=[],n=a("5530"),s=(a("a9e3"),a("caad"),a("2532"),a("d3b7"),a("159b"),a("ac1f"),a("00b4"),a("2934")),o=a("ca72"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{ref:"wkDialog",attrs:{title:"纸张尺寸",visible:t.visible,"append-to-body":!0,"close-on-click-modal":!1,width:"520px"},on:{close:t.close}},[a("el-form",{ref:"fieldForm",attrs:{model:t.pageData,"validate-on-rule-change":!1,"label-position":"top"}},[a("el-form-item",{staticClass:"wk-form-item",attrs:{label:"纸张大小",prop:"sizeName"}},[a("el-select",{on:{change:t.sizeChange},model:{value:t.pageData.sizeName,callback:function(e){t.$set(t.pageData,"sizeName",e)},expression:"pageData.sizeName"}},t._l(t.sizeOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})))],1),t._v(" "),a("flexbox",[a("el-form-item",{staticClass:"wk-form-item is-left",attrs:{label:"宽",prop:"width"}},[a("el-input-number",{attrs:{"controls-position":"right",step:.1,precision:1,min:1,max:99999,disabled:"custom"!==t.pageData.sizeName},model:{value:t.pageData.width,callback:function(e){t.$set(t.pageData,"width",e)},expression:"pageData.width"}}),a("span",{staticClass:"is-unit"},[t._v("mm")])],1),t._v(" "),a("el-form-item",{staticClass:"wk-form-item is-left",attrs:{label:"高",prop:"height"}},[a("el-input-number",{attrs:{"controls-position":"right",step:.1,precision:1,min:1,max:99999,disabled:"custom"!==t.pageData.sizeName},model:{value:t.pageData.height,callback:function(e){t.$set(t.pageData,"height",e)},expression:"pageData.height"}}),a("span",{staticClass:"is-unit"},[t._v("mm")])],1)],1),t._v(" "),a("el-form-item",{staticClass:"wk-form-item",attrs:{label:"页边距",prop:"marginName"}},[a("el-select",{on:{change:t.marginChange},model:{value:t.pageData.marginName,callback:function(e){t.$set(t.pageData,"marginName",e)},expression:"pageData.marginName"}},t._l(t.marginOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})))],1),t._v(" "),a("flexbox",[a("el-form-item",{staticClass:"wk-form-item is-left",attrs:{label:"上",prop:"top"}},[a("el-input-number",{attrs:{"controls-position":"right",step:.1,precision:1,min:1,max:550,disabled:"custom"!==t.pageData.marginName},model:{value:t.pageData.top,callback:function(e){t.$set(t.pageData,"top",e)},expression:"pageData.top"}}),a("span",{staticClass:"is-unit"},[t._v("mm")])],1),t._v(" "),a("el-form-item",{staticClass:"wk-form-item is-left",attrs:{label:"下",prop:"bottom"}},[a("el-input-number",{attrs:{"controls-position":"right",step:.1,precision:1,min:1,max:550,disabled:"custom"!==t.pageData.marginName},model:{value:t.pageData.bottom,callback:function(e){t.$set(t.pageData,"bottom",e)},expression:"pageData.bottom"}}),a("span",{staticClass:"is-unit"},[t._v("mm")])],1)],1),t._v(" "),a("flexbox",[a("el-form-item",{staticClass:"wk-form-item is-left",attrs:{label:"左",prop:"left"}},[a("el-input-number",{attrs:{"controls-position":"right",step:.1,precision:1,min:1,max:550,disabled:"custom"!==t.pageData.marginName},model:{value:t.pageData.left,callback:function(e){t.$set(t.pageData,"left",e)},expression:"pageData.left"}}),a("span",{staticClass:"is-unit"},[t._v("mm")])],1),t._v(" "),a("el-form-item",{staticClass:"wk-form-item is-left",attrs:{label:"右",prop:"right"}},[a("el-input-number",{attrs:{"controls-position":"right",step:.1,precision:1,min:1,max:550,disabled:"custom"!==t.pageData.marginName},model:{value:t.pageData.right,callback:function(e){t.$set(t.pageData,"right",e)},expression:"pageData.right"}}),a("span",{staticClass:"is-unit"},[t._v("mm")])],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.sureClick,expression:"sureClick"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),a("el-button",{nativeOn:{click:function(e){return t.close(e)}}},[t._v("取消")])],1)],1)},c=[],d=(a("99af"),a("9dba")),m={name:"PrintSizeDialog",components:{},mixins:[d["a"]],props:{defaultData:Object,visible:{type:Boolean,required:!0,default:!1}},data:function(){return{loading:!1,pageData:{sizeName:"210,297",width:210,height:297,marginName:"25.4,25.4,31.8,31.8",top:25.4,bottom:25.4,left:31.8,right:31.8},sizeOptions:[{value:"custom",label:"自定义"},{value:"210,297",label:"A4"},{value:"297,420",label:"A3"},{value:"148,210",label:"A5"},{value:"176,250",label:"B5"}],marginOptions:[{value:"custom",label:"自定义"},{value:"25.4,25.4,31.8,31.8",label:"常规"},{value:"12.7,12.7,12.7,12.7",label:"窄"},{value:"25.4,25.4,19.1,19.1",label:"中等"},{value:"25.4,25.4,50.8,50.8",label:"宽"}]}},computed:{},watch:{visible:function(t){t&&this.initInfo()}},created:function(){this.defaultData&&(this.pageData={sizeName:"".concat(this.defaultData.width,",").concat(this.defaultData.height),width:this.defaultData.width,height:this.defaultData.height,marginName:"".concat(this.defaultData.top,",").concat(this.defaultData.bottom,",").concat(this.defaultData.left,",").concat(this.defaultData.right),top:this.defaultData.top,bottom:this.defaultData.bottom,left:this.defaultData.left,right:this.defaultData.right})},beforeDestroy:function(){},methods:{sizeChange:function(){if("custom"!==this.pageData.sizeName){var t=this.pageData.sizeName.split(",");this.pageData.width=parseFloat(t[0]),this.pageData.height=parseFloat(t[1])}},marginChange:function(){if("custom"!==this.pageData.marginName){var t=this.pageData.marginName.split(",");this.pageData.top=parseFloat(t[0]),this.pageData.bottom=parseFloat(t[1]),this.pageData.left=parseFloat(t[2]),this.pageData.right=parseFloat(t[3])}},close:function(){this.$emit("update:visible",!1)},sureClick:function(){this.$emit("confirm",{top:this.pageData.top,bottom:this.pageData.bottom,left:this.pageData.left,right:this.pageData.right,width:this.pageData.width,height:this.pageData.height}),this.close()}}},p=m,u=(a("40bf"),a("2877")),h=Object(u["a"])(p,l,c,!1,null,"71cf9746",null),f=h.exports,g="print preview paste importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap quickbars emoticons lineheight rowspacing paste",v="undo redo | bold italic underline strikethrough | charmap emoticons | fontselect fontsizeselect formatselect | rowspacingtop rowspacingbottom | lineheight | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | table | forecolor backcolor removeformat | pagebreak | fullscreen  preview save print | insertfile image media link anchor codesample | ltr rtl | paste",w=a("0d44"),_=a.n(w),b=0,k=96/2.54,y={name:"Tinymce",components:{Editor:o["a"],PrintSizeDialog:f},inheritAttrs:!1,props:{value:String,init:Object,height:[String,Number],plugins:[String,Array],toolbar:[String,Array],menubar:[String,Array],isPrint:Boolean,printData:{type:Object,default:function(){return{top:25.4,bottom:25.4,left:31.8,right:31.8,width:210,height:297,header:"",footer:""}}}},data:function(){return{active:!1,id:this.uuid(),dataValue:"",languageTypeList:{en:"en",zh:"zh_CN",es:"es_MX",ja:"ja"},showInit:{},printSizeData:null,printSizeDialogVisible:!1,oldIframeHeight:0}},computed:{editor:function(){return window.tinymce.get(this.id)},showToolbar:function(){return void 0!=this.toolbar?this.toolbar:v},showPlugins:function(){return void 0!=this.plugins?this.plugins:g}},watch:{value:{handler:function(t){t!=this.dataValue&&(this.dataValue=t)},immediate:!0,deep:!0},dataValue:function(){this.$emit("input",this.dataValue)},init:{handler:function(){this.initTinymce()},immediate:!0,deep:!0}},mounted:function(){var t=this;this.$nextTick((function(){t.active=!0}))},methods:{initTinymce:function(){var t=this,e=Object(n["a"])({skin:"wukong",resize:!1,branding:!1,language:this.languageTypeList["zh"],menubar:!!this.menubar&&this.menubar,body_class:"panel-body",image_advtab:!0,end_container_on_empty_block:!0,powerpaste_word_import:"clean",content_css:["./static/tinymce/css/tiny-wukong.css"],fontsize_formats:"12px 14px 16px 18px 24px 36px 48px 56px 72px",font_formats:"Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats;微软雅黑=Microsoft YaHei,Helvetica Neue,PingFang SC,sans-serif;苹果苹方=PingFang SC,Microsoft YaHei,sans-serif;宋体=simsun,serif",code_dialog_height:450,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["72crm.com","5kcrm.com"],imagetools_proxy:"https://www.72crm.com/file.php",default_link_target:"_blank",link_assume_external_targets:!0,link_title:!1,target_list:!1,quickbars_insert_toolbar:!1,nonbreaking_force_tab:!0,convert_urls:!1,toolbar_mode:this.isPrint?"wrap":"sliding",paste_data_images:!0,images_upload_handler:function(t,e,a,i){i(0),Object(s["i"])({file:t.blob()}).then((function(t){e(t.data.url),i(100)})).catch((function(){a("出现未知问题，刷新页面，或者联系管理员")}))},watermark_click:function(){t.addWaterMark()},printsize_click:function(){t.printSizeDialogVisible=!0},pageheader_click:function(){if(!t.dataValue.includes("wkPrintHd")){var e="<header id=\"wkPrintHd\" class='wk-page-hdft page-hd-wrapper' contenteditable='false'>\n            <div id=\"wkPrintHdContent\" class='page-hdft-content' contenteditable='true'>在此输入内容</div>\n            <div class='page-hd-line'>\n              <div class='left-line'></div>\n              <div class='right-line'></div>\n            </div><span class='page-hdft-close'>关闭</span>\n          </header>";t.dataValue=e+t.dataValue,setTimeout((function(){t.addHeaderEvent()}),500)}},pagefooter_click:function(){if(!t.dataValue.includes("wkPrintFt")){var e='<footer id="wkPrintFt" class="wk-page-hdft page-ft-wrapper" contenteditable="false"><div id="wkPrintFtContent" class="page-hdft-content" contenteditable="true">在此输入内容</div><span class="page-hdft-close">关闭</span></footer>';t.dataValue=e+t.dataValue,setTimeout((function(){t.addFooterEvent()}),500)}}},this.init);void 0!=this.height&&(e.height=this.height),this.showInit=e},uuid:function(){var t=Date.now(),e=Math.floor(1e9*Math.random());return b++,"wukong_"+e+b+String(t)},addWaterMark:function(){var t=this;this.$prompt("请输入水印文字","提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{1,20}$/}).then((function(e){var a=e.value,i=t.editor.contentWindow;_.a.init({watermark_txt:a,window:i,document:i.document}),t.updateEditorContent()})).catch((function(){}))},updateEditorContent:function(){var t=this;this.$nextTick((function(){t.$emit("input",t.editor.getContent({format:t.$refs.mceEditor.$props.outputFormat}))}))},imageSuccessCBK:function(t){var e=this;t.forEach((function(t){e.editor.insertContent('<img class="wscnph" src="'.concat(t.url,'" >'))}))},sizeConfirm:function(t){var e=this.editor.iframeElement;if(e){this.printSizeData=t;var a={paddingTop:"".concat(t.top/10,"cm"),paddingBottom:"".concat(t.bottom/10,"cm"),paddingLeft:"".concat(t.left/10,"cm"),paddingRight:"".concat(t.right/10,"cm"),width:"".concat(t.width/10,"cm"),height:"".concat(this.editor.getBody().scrollHeight+(t.top+t.bottom)/10*k*2+8,"px"),minHeight:"".concat(t.height/10,"cm")};for(var i in a)e.style[i]=a[i];var r=this.editor.getBody();for(var n in r.style.minHeight="".concat((t.height-t.top-t.bottom)/10,"cm"),t)this.printData[n]=t[n];this.updateIframeHeight()}},onInit:function(){var t=this;this.isPrint&&this.editor.on("NodeChange SetContent keyup input FullscreenStateChanged ResizeContent",(function(e){t.updateIframeHeight(),t.addHeaderEvent(),t.addFooterEvent()}))},addHeaderEvent:function(){var t=this,e=this.editor.dom.get("wkPrintHd"),a=this.editor.getBody(),i=64;if(e&&a.style.paddingTop!=="".concat(i,"px")){a.style.paddingTop="".concat(i,"px");var r=this.editor.dom.select(".page-hd-wrapper .page-hdft-close"),n=r&&r.length>0?r[0]:null;n&&this.editor.dom.bind(n,"click",(function(){var a=t.editor.getBody();e.remove(),t.editor.dom.remove("wkPrintHd"),a.style.paddingTop=0,t.updateEditorContent(),t.updateIframeHeight()})),this.updateEditorContent(),this.updateIframeHeight()}},addFooterEvent:function(){var t=this,e=this.editor.dom.get("wkPrintFt"),a=this.editor.getBody(),i=45;if(e&&a.style.paddingBottom!=="".concat(i,"px")){a.style.paddingBottom="".concat(i,"px");var r=this.editor.dom.select(".page-ft-wrapper .page-hdft-close"),n=r&&r.length>0?r[0]:null;n&&(n.onclick=function(){var a=t.editor.getBody();e.remove(),t.editor.dom.remove("wkPrintFt"),a.style.paddingBottom=0,t.updateEditorContent(),t.updateIframeHeight()}),this.updateEditorContent(),this.updateIframeHeight()}},updateIframeHeight:function(){var t=this.editor.getBody(),e=t.scrollHeight,a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=a?50:20,r=e+(this.printData.top+this.printData.bottom)/10*k+i;this.oldIframeHeight!==r&&(this.oldIframeHeight=r,this.editor.iframeElement.style.height="".concat(r,"px"))}}},x=y,C=(a("e31e"),Object(u["a"])(x,i,r,!1,null,null,null));e["a"]=C.exports},"9dba":function(t,e,a){"use strict";e["a"]={watch:{loading:function(t){if(t){var e=this.$refs.wkDialog.$refs.dialog;this.loadingInstance=this.$loading({target:e})}else this.loadingInstance&&this.loadingInstance.close()}}}},"9ef2":function(t,e,a){},d302:function(t,e,a){},ddc5:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"create-container"},[a("el-dialog",{staticClass:"kl-edit-dialog",attrs:{"show-close":!1,visible:t.dialogVisible,"before-close":t.handleClose,width:"800px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("flexbox",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"create-body",attrs:{align:"flex-start"}},[a("div",{staticClass:"create-body_nav"},[a("div",{staticClass:"title"},[t._v("知识库设置")]),t._v(" "),a("div",{staticClass:"create-body_nav__item",class:{active:0===t.activeNavIndex},on:{click:function(e){t.activeNavIndex=0}}},[a("i",{staticClass:"wk wk-project icon"}),t._v(" "),a("span",[t._v("知识库信息")])]),t._v(" "),0===t.form.isOpen?a("div",{staticClass:"create-body_nav__item",class:{active:1===t.activeNavIndex},on:{click:function(e){t.activeNavIndex=1}}},[a("i",{staticClass:"wk wk-employees icon"}),t._v(" "),a("span",[t._v("成员管理")])]):t._e()]),t._v(" "),a("flexbox-item",{staticClass:"create-body_content"},[0===t.activeNavIndex?a("el-form",{ref:"form",staticClass:"form",attrs:{model:t.form,"label-position":"top"}},[a("el-form-item",{staticClass:"wk-form-item",attrs:{label:"知识库封面"}},[a("flexbox",{staticClass:"img-body"},[a("div",{staticClass:"img-left"},[a("img",{directives:[{name:"src",rawName:"v-src",value:t.form.coverUrl,expression:"form.coverUrl"}],staticClass:"img",attrs:{alt:""}})]),t._v(" "),a("flexbox-item",{staticClass:"img-right",attrs:{align:"flex-start",justify:"center",direction:"column"}},[a("div",{staticClass:"img-list"},t._l(t.coverImgList,(function(e,i){return a("img",{key:i,staticClass:"img",attrs:{src:e,alt:"封面图"},on:{click:function(e){t.handleChooseImg(i)}}})}))),t._v(" "),a("el-button",{on:{click:t.handleToChooseFile}},[t._v("\n                  本地上传\n                ")])],1)],1)],1),t._v(" "),a("el-form-item",{staticClass:"wk-form-item",attrs:{label:"知识库名称",prop:"name",rules:[{required:!0,message:"知识库名称不能为空",trigger:"change"}]}},[a("el-input",{attrs:{maxlength:50,placeholder:"请输入内容"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{staticClass:"wk-form-item",attrs:{label:"知识库描述"}},[a("el-input",{attrs:{rows:4,maxlength:300,"show-word-limit":"",type:"textarea",resize:"none",placeholder:"请输入内容"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),t._v(" "),a("el-form-item",{staticClass:"wk-form-item",attrs:{label:"可见范围"}},[a("el-select",{model:{value:t.form.isOpen,callback:function(e){t.$set(t.form,"isOpen",e)},expression:"form.isOpen"}},t._l(t.openOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})))],1)],1):1===t.activeNavIndex?a("div",{staticClass:"group"},[a("flexbox",{staticClass:"group-title"},[a("flexbox-item",[t._v("\n              知识库成员\n            ")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.selectEmployeeShow=!0}}},[t._v("\n              添加成员\n            ")])],1),t._v(" "),a("div",{staticClass:"group-body"},[t._l(t.userList,(function(e,i){return a("flexbox",{key:"user-"+i,staticClass:"group-user",attrs:{align:"flex-start",justify:"center"}},[a("div",{staticClass:"group-user-info"},[a("xr-avatar",{staticClass:"user-img",attrs:{name:t.$getUserName(e),size:32,src:e.img}}),t._v(" "),a("div",{staticClass:"user-info"},[a("div",{staticClass:"name"},[t._v("\n                    "+t._s(t.$getUserName(e))+"\n                  ")]),t._v(" "),a("div",{staticClass:"dept-name"},[t._v("\n                    "+t._s(e.deptName||"暂无部门信息")+"\n                  ")])])],1),t._v(" "),a("el-dropdown",{ref:"userDropdown",refInFor:!0,attrs:{trigger:"click"},on:{command:function(e){t.handleCommand(e,i)}}},[a("el-button",{staticClass:"dropdown-btn",class:{disabled:1===e.role},attrs:{disabled:1===e.role,type:"text"}},[t._v("\n                  "+t._s(t.roleObj[e.role])+"\n                  "),a("i",{staticClass:"el-icon-arrow-down el-icon--right "})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.memberAuthList,(function(e,i){return a("el-dropdown-item",{key:i,attrs:{command:e.value}},[a("div",{staticStyle:{display:"flex","flex-direction":"column"}},[a("span",[t._v(t._s(e.label))]),t._v(" "),a("span",{staticStyle:{"line-height":"25px",color:"#7a869a"}},[t._v(t._s(e.desc))])])])})))],1)],1)})),t._v(" "),a("el-tree",{staticClass:"group-dept",attrs:{data:t.showDeptTreeList,props:{label:"name",children:"childrenList"},"node-key":"deptId"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.data;return a("div",{staticClass:"group-dept-tree"},[a("xr-avatar",{staticClass:"user-img",attrs:{name:i.name,size:32}}),t._v("\n                "+t._s(i.name)+"\n\n                "),a("div",{staticStyle:{"margin-left":"auto"},on:{click:function(t){t.stopPropagation()}}},[a("el-dropdown",{ref:"deptDropdown"+i.deptId,attrs:{trigger:"click"},on:{command:function(e){t.handleDeptTreeCommand(e,i.deptId)}}},[a("el-button",{staticClass:"dropdown-btn",attrs:{type:"text"}},[t._v("\n                      "+t._s(t.roleObj[i.role])+"\n                      "),a("i",{staticClass:"el-icon-arrow-down el-icon--right "})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.memberAuthList,(function(e,i){return a("el-dropdown-item",{key:i,attrs:{command:e.value}},[a("div",{staticStyle:{display:"flex","flex-direction":"column"}},[a("span",[t._v(t._s(e.label))]),t._v(" "),a("span",{staticStyle:{"line-height":"25px",color:"#7a869a"}},[t._v(t._s(e.desc))])])])})))],1)],1)],1)}}])})],2)],1):t._e(),t._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.handleConfirm}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:t.handleClose}},[t._v("取消")])],1)],1)],1)],1),t._v(" "),a("input",{ref:"fileHook",staticClass:"file-input",attrs:{accept:"image/*",type:"file"},on:{change:t.handleFileUpload}}),t._v(" "),a("wk-dep-user-dialog",{attrs:{visible:t.selectEmployeeShow,"sub-dept-contain":t.isNeedChild,"user-value":t.selectUserIds,"dep-value":t.selectDeptIds,props:{showDisableUser:!1,showDept:!0,showSubDeptContain:!0}},on:{"update:visible":function(e){t.selectEmployeeShow=e},"update:subDeptContain":function(e){t.isNeedChild=e},change:t.userSelectChange}})],1)},r=[],n=a("5530"),s=(a("d81d"),a("14d9"),a("b0c0"),a("a4d3"),a("e01a"),a("c740"),a("a434"),a("3c65"),a("4de4"),a("d3b7"),a("159b"),a("caad"),a("2532"),a("99af"),a("3ca3"),a("ddb0"),a("2934")),o=a("b729"),l=a("2581"),c=a("2f62"),d={name:"EditDialog",components:{WkDepUserDialog:l["a"]},props:{data:{type:Object,required:!0}},data:function(){return{dialogVisible:!0,activeNavIndex:0,fieldId:null,coverImgList:["https://file.72crm.com/static/pc/images/kw/1.png","https://file.72crm.com/static/pc/images/kw/2.png","https://file.72crm.com/static/pc/images/kw/3.png","https://file.72crm.com/static/pc/images/kw/4.png","https://file.72crm.com/static/pc/images/kw/5.png","https://file.72crm.com/static/pc/images/kw/6.png","https://file.72crm.com/static/pc/images/kw/7.png","https://file.72crm.com/static/pc/images/kw/8.png"],openOptions:[{value:0,label:"私有：只有加入的成员才能看见此项目"},{value:1,label:"公开：企业所有成员都可以看见此项目"}],form:{isOpen:0},memberAuthList:[{label:"管理员",desc:"当前知识库所有权限",value:2},{label:"成员",desc:"可上传文件",value:3},{label:"移出",desc:"",value:-1}],ownerUser:null,selectEmployeeShow:!1,userList:[],deptList:[],isNeedChild:0,roleObj:{1:"拥有者",2:"管理员",3:"成员"},loading:!1}},computed:Object(n["a"])(Object(n["a"])({},Object(c["b"])(["userInfo","userDeptObj"])),{},{selectUserIds:function(){return(this.userList||[]).map((function(t){return t.userId}))},selectDeptIds:function(){return(this.deptList||[]).map((function(t){return t.deptId}))},showDeptTreeList:function(){var t=function(t){for(var e={},a=[],i=0;i<t.length;i+=1)e[t[i].deptId]=i,t[i].childrenList=[];for(var r=0;r<t.length;r+=1){var n=t[r];"0"!==n.parentId&&void 0!=e[n.parentId]?t[e[n.parentId]].childrenList.push(n):a.push(n)}return a};return t(this.deptList)}}),created:function(){this.form={libraryId:this.data.libraryId,name:this.data.name,description:this.data.description,isOpen:this.data.isOpen,coverUrl:this.data.coverUrl,aiServiceSwitch:this.data.aiServiceSwitch},this.getMember()},methods:{handleChooseImg:function(t){this.form.coverUrl=this.coverImgList[t]},handleToChooseFile:function(){this.$refs.fileHook.value=null,this.$refs.fileHook.click()},handleFileUpload:function(t){var e=this,a=t.target.files[0];this.loading=!0,Object(s["d"])({file:a}).then((function(t){var a=t.data||{};e.loading=!1,e.fieldId&&(e.deleteFile(),e.fileId=a.fileId),e.form.coverUrl=a.url})).catch((function(){e.loading=!1}))},deleteFile:function(){Object(s["c"])({id:this.fileId}).then((function(){})).catch((function(){}))},getMember:function(){var t=this;this.loading=!0,Object(o["l"])({libraryId:this.data.libraryId}).then((function(e){t.loading=!1;var a=e.data||[],i=a.findIndex((function(t){return 1==t.role}));t.ownerUser=a.splice(i,1)[0],a.unshift(t.ownerUser),t.userList=a.filter((function(t){return!t.type||t.userId})),t.deptList=a.filter((function(t){return t.type||t.deptId})).map((function(t){return Object(n["a"])(Object(n["a"])({},t),{},{parentId:t.parentDeptId,name:t.deptName})}))})).catch((function(){t.loading=!1}))},handleCommand:function(t,e){t?-1!==t?(this.userList[e].role=t,this.$set(this.userList,e,this.userList[e])):this.userList.splice(e,1):this.$refs.userDropdown[e].show()},handleDeptTreeCommand:function(t,e){if(t){var a=this.deptList.filter((function(t){return t.deptId==e}))[0];-1!==t?a.role=t:this.deptList=this.deptList.filter((function(t){return t.deptId!=e}))}else this.$refs["deptDropdown".concat(e)].show()},handleClose:function(){this.dialogVisible=!1,this.$emit("close")},userSelectChange:function(t,e,a,i){var r=this;this.userList=[this.ownerUser],this.deptList=[],a.forEach((function(t){t.userId!=r.ownerUser.userId&&(t.hasOwnProperty("role")?r.userList.push(t):r.userList.push(Object(n["a"])(Object(n["a"])({},t),{},{role:3})))}));var s=[];this.isNeedChild?this.handleIncludeSubsDept(i,s):s=i,s.forEach((function(t){r.deptList.push(Object(n["a"])(Object(n["a"])({},t),{},{role:3}))}))},handleIncludeSubsDept:function(t,e){var a=this,i=e.map((function(t){return t.deptId}));t.forEach((function(t){i.includes(t.deptId)||e.push(t),t.children&&t.children.length&&a.handleIncludeSubsDept(t.children,e)}))},handleConfirm:function(){var t=this;if(this.form.name){var e=Object(n["a"])(Object(n["a"])({},this.form),{},{isSystemCover:this.coverImgList.includes(this.form.coverUrl)?1:0,userList:0===this.form.isOpen?this.userList.map((function(t){return t.userId})):null}),a=this.userList.filter((function(t){return 1!=t.role}))||[],i=a.map((function(t){return{userId:t.userId,role:t.role,type:0}})),r=this.deptList.map((function(t){return{deptId:t.deptId,role:t.role,type:1}})),s={userList:i.concat(r),libraryId:this.data.libraryId};0!==this.form.isOpen&&(s.userList=[]);var l=[Object(o["e"])(e),Object(o["r"])(s)];Promise.all(l).then((function(){t.$emit("update"),t.handleClose(),t.$message.success("修改成功")})).catch()}else this.$message.error("知识库名称不能为空")}}},m=d,p=(a("3ada"),a("2877")),u=Object(p["a"])(m,i,r,!1,null,"7f65fabe",null);e["a"]=u.exports},e31e:function(t,e,a){"use strict";a("307c")},fdca:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("flexbox",{staticClass:"wk-page-header",attrs:{justify:"space-between"}},[a("div",{staticClass:"wk-page-header__left"},[t.title||t.$slots.title?a("span",{staticClass:"wk-page-header-title"},[t._t("title",[t._v(t._s(t.title))])],2):t._e(),t._v(" "),t.help?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":t.help.type,"data-id":t.help.id}}):t._e(),t._v(" "),t._t("left")],2),t._v(" "),a("div",{staticClass:"wk-page-header__center"},[t._t("center")],2),t._v(" "),a("div",{staticClass:"wk-page-header__right"},[t._t("right"),t._v(" "),t.dropdowns&&t.dropdowns.length>0?a("el-dropdown",{class:{"margin-left-interval":t.$slots.right},attrs:{trigger:"click"},on:{command:t.dropdownCommand}},[a("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.dropdowns,(function(e,i){return a("el-dropdown-item",{key:i,attrs:{icon:e.icon,command:e.command}},[t._v(t._s(e.name))])})))],1):t._e()],2)])},r=[],n={name:"WkPageHeader",components:{},props:{title:String,dropdowns:Array,help:Object},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{dropdownCommand:function(t){this.$emit("command",t)}}},s=n,o=(a("2309"),a("2877")),l=Object(o["a"])(s,i,r,!1,null,"985b7582",null);e["a"]=l.exports}}]);